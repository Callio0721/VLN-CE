BASE_TASK_CONFIG_PATH: habitat_extensions/config/vlnce_task_aug.yaml

# -----------------------------------------------------------------------------
# ç¡¬ä»¶ä¸ç³»ç»Ÿè®¾ç½®
# -----------------------------------------------------------------------------
SIMULATOR_GPU_IDS: [0, 1, 2, 3] # ä½¿ç”¨ 4 å¼ æ˜¾å¡è·‘æ¨¡æ‹Ÿå™¨
TORCH_GPU_ID: 0                 # ä½¿ç”¨ 0 å·å¡è·‘æ¨¡å‹è®­ç»ƒ
# âš ï¸ å†…å­˜å®‰å…¨è®¾ç½®ï¼š
# ä¹‹å‰æµ‹è¯• 4 ä¼šå¯¼è‡´å†…å­˜(RAM)åƒç´§ï¼Œ3 æ˜¯æ¯”è¾ƒç¨³å¦¥çš„é€‰æ‹© (æ€»å…± 4x3=12 ä¸ªç¯å¢ƒ)
# å¦‚æœå‘ç° Swap è¿˜æ˜¯å¾ˆé«˜ï¼Œå¯ä»¥é™ä¸º 2
NUM_ENVIRONMENTS: 6

TENSORBOARD_DIR: data/tensorboard_dirs/cma_clip_bert_pm_aug
CHECKPOINT_FOLDER: data/checkpoints/cma_clip_bert_pm_aug
EVAL_CKPT_PATH_DIR: data/checkpoints/cma_clip_bert_pm_aug
RESULTS_DIR: data/checkpoints/cma_clip_bert_pm_aug/evals

# -----------------------------------------------------------------------------
# è¯„ä¼°è®¾ç½®
# -----------------------------------------------------------------------------
EVAL:
  USE_CKPT_CONFIG: False
  SPLIT: val_unseen
  EPISODE_COUNT: -1

# -----------------------------------------------------------------------------
# æ¨¡ä»¿å­¦ä¹  (Imitation Learning) è®¾ç½®
# -----------------------------------------------------------------------------
IL:
  # å®˜æ–¹é»˜è®¤ 45ï¼ŒBERT+CLIP æ”¶æ•›å¿«ï¼Œä½†ä¿æŒ 45 å¯ä»¥è·‘å‡ºæ›´é«˜åˆ†
  epochs: 45
  batch_size: 5

  DAGGER:
    iterations: 1 # Stage 1: çº¯ Teacher Forcing
    lmdb_fp16: True
    # R2R (10k) + Aug (147k) â‰ˆ 15.7ä¸‡æ¡æ•°æ®
    # è¿™æ˜¯æœ€è€—æ—¶çš„æ­¥éª¤ï¼Œè¿›åº¦æ¡ä¼šèµ°å¾ˆä¹…ï¼Œè€å¿ƒç­‰å¾…
    update_size: 157232
    
    p: 1.0

    # ç¬¬ä¸€æ¬¡è·‘è®¾ä¸º False (ç”Ÿæˆæ•°æ®)
    # å¦‚æœä¸­é€”æ–­äº†æƒ³ç»­ä¼ ï¼Œä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹ç›®å½•éç©ºï¼Œä¸ç”¨æ‰‹åŠ¨æ”¹ True
    preload_lmdb_features: False
    lmdb_features_dir: data/trajectories_dirs/cma_clip_bert_pm_aug/trajectories.lmdb
    lmdb_map_size: 2e12

# -----------------------------------------------------------------------------
# ä»»åŠ¡ä¸ä¼ æ„Ÿå™¨é…ç½® (å…³é”®ä¿®æ”¹ï¼)
# -----------------------------------------------------------------------------
TASK_CONFIG:
  TASK:
    # è¦†ç›–æ—§ Sensor åˆ—è¡¨
    SENSORS: ['BERT_INSTRUCTION_SENSOR', 'SHORTEST_PATH_SENSOR', 'VLN_ORACLE_PROGRESS_SENSOR']
    
    # å®šä¹‰ BERT Sensor å‚æ•°
    BERT_INSTRUCTION_SENSOR:
      TYPE: BertInstructionSensor
      MAX_LENGTH: 200

# -----------------------------------------------------------------------------
# æ¨¡å‹ç»“æ„é…ç½®
# -----------------------------------------------------------------------------
MODEL:
  policy_name: CMAPolicy

  # --- 1. è¯­è¨€ç¼–ç å™¨ (BERT) ---
  INSTRUCTION_ENCODER:
    # ä¿®æ­£æ—¥å¿—æ˜¾ç¤º (è¦†ç›–é»˜è®¤çš„ LSTM)
    rnn_type: "BERT"      # è¿™é‡Œå¯ä»¥æ˜¯BERTæˆ–LSTM
    vocab_size: 30522     # ä¿®æ­£è¯è¡¨å¤§å°æ˜¾ç¤º
    embedding_size: 768   # ä¿®æ­£ç»´åº¦æ˜¾ç¤º
    # è¿™é‡Œçš„å‚æ•°å¯¹åº”æˆ‘ä»¬å†™çš„ BertInstructionEncoder.__init__
    hidden_size: 256       # æŠ•å½±åˆ°ä¸è§†è§‰ç‰¹å¾ä¸€è‡´çš„ç»´åº¦

    # True  = å…¨é‡å¾®è°ƒ (BERTå‚æ•°å˜ + Linearå‚æ•°å˜) -> æ˜¾å­˜å ç”¨å¤§ï¼Œæ•ˆæœä¸Šé™é«˜
    # False = å†»ç»“BERT (BERTå‚æ•°ä¸å˜ï¼Œåªè®­ç»ƒåé¢çš„Linear) -> æ˜¾å­˜å°ï¼ŒåƒCLIPä¸€æ ·
    fine_tune_bert: False   # å¼€å¯å¾®è°ƒï¼Œè®© BERT é€‚åº”å¯¼èˆªæŒ‡ä»¤
    # bidirectional: True  # BERT å¤©ç”ŸåŒå‘ï¼Œè¿™ä¸ªå‚æ•°å®é™…ä¸Šè¢«æˆ‘ä»¬æ–°ä»£ç å¿½ç•¥äº†ï¼Œç•™ç€ä¹Ÿä¸æŠ¥é”™

    # rnn_type: "LSTM"      # ğŸ‘ˆ æ”¹å› LSTMï¼Œä»£ç è‡ªåŠ¨åˆ‡å›æ—§æ¨¡å‹
    # # fine_tune_bert: False # è¿™è¡Œåˆ ä¸åˆ éƒ½æ— æ‰€è°“ï¼Œå› ä¸º LSTM ä»£ç ä¸è¯»å®ƒ
    # vocab_size: 2504
    # embedding_size: 50


  # --- 2. è§†è§‰ç¼–ç å™¨ (CLIP) ---
  RGB_ENCODER:
    cnn_type: "ClipVisualEncoder"
    output_size: 256
    trainable: True  # è®­ç»ƒ Adapter/Projection å±‚

  # --- 3. è¿›åº¦ç›‘æ§ (è¾…åŠ©ä»»åŠ¡) ---
  PROGRESS_MONITOR:
    use: True
    alpha: 1.0       # Loss æƒé‡


# è¿è¡Œè¿™ä¸ªé…ç½®çš„ä»£ç 
# python run.py     --exp-config vlnce_baselines/config/r2r_baselines/cma_clip_bert_pm_aug.yaml     --run-type train     SIMULATOR_GPU_IDS "[1]"     TORCH_GPU_ID 1     NUM_ENVIRONMENTS 1     IL.DAGGER.update_size 20     IL.epochs 2     IL.batch_size 2     TENSORBOARD_DIR data/tensorboard_dirs/debug_test     CHECKPOINT_FOLDER data/checkpoints/debug_test     IL.DAGGER.lmdb_commit_frequency 1  # ğŸ‘ˆ å…³é”®ä¿®æ”¹ï¼šæ¯è·‘å®Œ1æ¡æ•°æ®å°±ç«‹å³å­˜ç›˜ï¼Œç³»ç»Ÿè®¾å®šæ˜¯500æ¡ï¼Œéå¸¸å¤§ï¼Œä¸é€‚åˆæµ‹è¯•
# python run.py     --exp-config vlnce_baselines/config/r2r_baselines/cma_clip_bert_pm_aug.yaml     --run-type train     SIMULATOR_GPU_IDS "[1]"     TORCH_GPU_ID 1     NUM_ENVIRONMENTS 1     IL.DAGGER.update_size 20     IL.epochs 2     IL.batch_size 2     TENSORBOARD_DIR data/tensorboard_dirs/debug_test     CHECKPOINT_FOLDER data/checkpoints/debug_test     IL.DAGGER.lmdb_commit_frequency 1