BASE_TASK_CONFIG_PATH: habitat_extensions/config/vlnce_task.yaml # DAgger é˜¶æ®µé€šå¸¸ç”¨æ ‡å‡† Task é…ç½®

# -----------------------------------------------------------------------------
# ç¡¬ä»¶ä¸ç³»ç»Ÿè®¾ç½®
# -----------------------------------------------------------------------------
SIMULATOR_GPU_IDS: [0, 1, 2, 3, 4, 5, 6, 7]  # å»ºè®®ä¸ Stage 1 ä¿æŒä¸€è‡´æˆ–æ ¹æ®æ˜¾å¡ç©ºé—²æƒ…å†µè°ƒæ•´
TORCH_GPU_ID: 1
# DAgger éœ€è¦å®æ—¶é‡‡æ ·ï¼Œå†…å­˜å‹åŠ›è¾ƒå¤§ã€‚
# å»ºè®®ä¿å®ˆè®¾ç½®ï¼Œå¦‚æœæ˜¾å­˜å¤Ÿå¤§å¯ä»¥è®¾ä¸º 2 æˆ– 3
NUM_ENVIRONMENTS: 3

TENSORBOARD_DIR: data/tensorboard_dirs/cma_clip_bert_pm_da_aug_tune
CHECKPOINT_FOLDER: data/checkpoints/cma_clip_bert_pm_da_aug_tune
EVAL_CKPT_PATH_DIR: data/checkpoints/cma_clip_bert_pm_da_aug_tune
RESULTS_DIR: data/checkpoints/cma_clip_bert_pm_da_aug_tune/evals

# -----------------------------------------------------------------------------
# è¯„ä¼°è®¾ç½®
# -----------------------------------------------------------------------------
EVAL:
  USE_CKPT_CONFIG: False
  SPLIT: val_unseen
  EPISODE_COUNT: -1

# -----------------------------------------------------------------------------
# DAgger å¾®è°ƒè®¾ç½® (æ ¸å¿ƒé€»è¾‘)
# -----------------------------------------------------------------------------
IL:
  # DAgger çš„å†…å±‚å¾ªç¯ï¼šæ¯ä¸€è½®é‡‡æ ·åï¼Œè®­ç»ƒå‡ ä¸ª Epoch
  epochs: 4
  batch_size: 5 # ä¿æŒä¸ Stage 1 ä¸€è‡´æˆ–ç•¥å°

  # ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®ï¼šåŠ è½½ Stage 1 çš„æƒé‡ ğŸ”¥ğŸ”¥ğŸ”¥
  load_from_ckpt: True
  # âš ï¸âš ï¸âš ï¸ è¯·æ‰‹åŠ¨ä¿®æ”¹è¿™é‡Œï¼æŒ‡å‘ä½  Stage 1 è·‘å‡ºæ¥çš„æœ€ä½³æ¨¡å‹è·¯å¾„ âš ï¸âš ï¸âš ï¸
  ckpt_to_load: data/checkpoints/cma_clip_bert_pm_aug/ckpt.5.pth

  DAGGER:
    # å¤–å±‚å¾ªç¯ï¼šé‡‡æ · -> è®­ç»ƒ -> é‡‡æ · -> è®­ç»ƒ
    iterations: 10
    
    # æ¯æ¬¡é‡‡æ ·å¤šå°‘æ¡æ–°æ•°æ® (R2R æ ‡å‡†æ˜¯ 5000)
    update_size: 5000
    
    # æ··åˆç­–ç•¥æ¦‚ç‡ï¼š0.5 æˆ– 0.75
    # 0.5 = 50% æ¦‚ç‡å¬ä¸“å®¶çš„ï¼Œ50% æ¦‚ç‡ç”¨ BERT æ¨¡å‹è‡ªå·±é¢„æµ‹
    p: 0.5

    # âš ï¸ å¿…é¡»ä¸º Falseï¼šæˆ‘ä»¬è¦åœ¨çº¿é‡‡é›†æ•°æ®ï¼Œä¸èƒ½è¯»ç¡¬ç›˜é‡Œçš„æ—§æ•°æ®
    preload_lmdb_features: False
    
    # è¿™äº›æ–°æ•°æ®æš‚å­˜çš„ä½ç½® (æ¯è½®ä¼šè¢«è¦†ç›–)
    lmdb_features_dir: data/trajectories_dirs/cma_clip_bert_pm_da_aug_tune/trajectories.lmdb
    lmdb_map_size: 1e12
    lmdb_fp16: True
    # âš ï¸ æäº¤é¢‘ç‡è®¾ä¸º 500ï¼Œåƒä¸‡ä¸è¦è®¾ä¸º 1ï¼Œå¦åˆ™æ…¢æ­»
    lmdb_commit_frequency: 500

# -----------------------------------------------------------------------------
# ä»»åŠ¡ä¸ä¼ æ„Ÿå™¨é…ç½® (å¿…é¡»åŒ…å« BERT Sensor è®¾ç½®ï¼)
# -----------------------------------------------------------------------------
TASK_CONFIG:
  TASK:
    # è¦†ç›–æ—§ Sensor åˆ—è¡¨ï¼Œç¡®ä¿åŒ…å« BERT Sensor å’Œ DAgger å¿…éœ€çš„ SHORTEST_PATH_SENSOR
    SENSORS: ['BERT_INSTRUCTION_SENSOR', 'SHORTEST_PATH_SENSOR', 'VLN_ORACLE_PROGRESS_SENSOR']
    
    # å®šä¹‰ BERT Sensor å‚æ•° (å¿…é¡»ä¸ Stage 1 ä¸€è‡´ï¼Œå¦åˆ™ç»´åº¦å¯¹ä¸ä¸Š)
    BERT_INSTRUCTION_SENSOR:
      TYPE: BertInstructionSensor
      MAX_LENGTH: 200

# -----------------------------------------------------------------------------
# æ¨¡å‹ç»“æ„é…ç½® (å¿…é¡»ä¸ Stage 1 å®Œå…¨ä¸€è‡´)
# -----------------------------------------------------------------------------
MODEL:
  policy_name: CMAPolicy

  # --- 1. è¯­è¨€ç¼–ç å™¨ (BERT) ---
  INSTRUCTION_ENCODER:
    rnn_type: "BERT"
    vocab_size: 30522
    embedding_size: 768
    hidden_size: 256
    
    # âš ï¸ æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»å’Œä½  Stage 1 è®­ç»ƒæ—¶çš„è®¾ç½®ä¿æŒä¸€è‡´ï¼
    # å¦‚æœä½  Stage 1 æ˜¯ Falseï¼Œè¿™é‡Œä¹Ÿå¾—æ˜¯ Falseï¼Œå¦åˆ™æƒé‡åŠ è½½ä¼šä¸åŒ¹é…
    fine_tune_bert: False 

  # --- 2. è§†è§‰ç¼–ç å™¨ (CLIP) ---
  RGB_ENCODER:
    cnn_type: "ClipVisualEncoder"
    output_size: 256
    trainable: True 

  # --- 3. è¿›åº¦ç›‘æ§ ---
  PROGRESS_MONITOR:
    use: True
    alpha: 1.0